<!DOCTYPE html>
<html>
<head>
    <title>Hello World with Custom Colored Slider</title>
    <style>
        /* Center-align the container and make it 50% of the window size */
        .slider-container {
            width: 80%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 50vh;
        }

        /* Style the custom slider container */
        .custom-slider-container {
            width: 100%;
            position: relative;
            background: linear-gradient(to right, blue, red); /* Apply a color gradient from blue (cold) to red (hot) */
            height: 20px; /* Set the height of the slider container */
            border-radius: 10px; /* Add some border-radius for style */
            margin-top: 20px; /* Add margin to separate from the tick values */
            cursor: pointer; /* Change the cursor to a pointer when hovering over the slider */
        }

        /* Style the custom slider thumb */
        .custom-slider-thumb {
            width: 30px;
            height: 30px;
            background-color: white; /* Fixed color for the slider thumb */
            border-radius: 50%; /* Make the thumb round */
			border: 2px solid black; /* Add a black border to the slider thumb */
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            transition: left 0.2s; /* Add a smooth transition for the thumb movement */
        }

        /* Style the value display */
        .slider-value-container {
            display: flex;
            align-items: center;
        }

        .slider-value {
            margin-left: 10px;
            font-size: 24px;
            font-weight: bold;
            border: 2px solid #333;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: #fff;
            color: #333; /* Set the text color to black by default */
        }
		
		/* Style for the text labels above the slider */
		.slider-label {
			position: absolute;
			top: -60px; /* Adjust the top value as needed to position the labels */
			font-size: 24px; /* Adjust the font size as needed */
			text-align: center;
			width: 250px; /* Adjust the width as needed to match the label text length */
			left: calc(0% - 30px); /* Adjust the left value to align with the corresponding slider values */
			user-select: none; /* Disable text selection on the labels */
		}

		/* Position labels for specific slider values */
		.slider-label:nth-child(1) {
			left: calc(0% - 60px); /* Position for -3 */
		}

		.slider-label:nth-child(2) {
			left: calc(50% - 60px); /* Position for 0 */
		}

		.slider-label:nth-child(3) {
			left: calc(100% - 60px); /* Position for 3 */
		}

        /* Style for tick values */
        .tick-values {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        /* Style for the clock */
        .clock {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        /* Style for the buttons */
        .button-container {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }

        .button {
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
        }

        /* Style for the "Start" button when recording */
        .start-button-recording {
            background-color: green; /* Change the background color to green when recording */
            color: white; /* Set text color to white for better visibility */
        }

        /* Style for the file name input box */
        .file-name-input {
            font-size: 16px;
            padding: 5px;
            margin-top: 10px;
        }
		
		h1 {
			text-align: center;
		}
    </style>
</head>
<body>
    <h1>Scent intensity and quality database</h1>

    <!-- Add a clock to display date and time -->
    <div class="clock" id="clock"></div>

    <!-- Add a container for the custom slider and its value display -->
    <div class="slider-container">
        <div class="custom-slider-container" id="sliderContainer">
			<!-- Add text labels for specific values above the slider -->
			<span class="slider-label">Extremely unpleasant</span>
			<span class="slider-label">Neither pleasant nor unpleasant</span>
			<span class="slider-label">Extremely pleasant</span>
            <div class="custom-slider-thumb" id="sliderThumb"></div>
        </div>
        <div class="slider-value-container">
            <span>Hedonic tone:</span>
            <div class="slider-value" id="sliderValue">0</div>
        </div>
        <div class="tick-values">
            <!-- Add tick values from -4 to 4 in steps of 0.5 -->
			<span>-4</span>
            <span>-3.5</span>
            <span>-3</span>
            <span>-2.5</span>
            <span>-2</span>
            <span>-1.5</span>
            <span>-1</span>
            <span>-0.5</span>
            <span>0</span>
            <span>0.5</span>
            <span>1</span>
            <span>1.5</span>
            <span>2</span>
            <span>2.5</span>
            <span>3</span>
			<span>3.5</span>
            <span>4</span>
        </div>

        <!-- Add an input box for file name -->
        <input type="text" class="file-name-input" placeholder="Enter File Name" id="fileNameInput">
    </div>

    <!-- Add buttons to start and stop updating the CSV file -->
    <div class="button-container">
        <button class="button" id="startButton">Start</button>
        <button class="button" id="stopButton">Stop</button>
    </div>

    <script>
        // JavaScript code to control the custom slider and update the displayed value and its color
        const sliderContainer = document.getElementById("sliderContainer");
        const sliderThumb = document.getElementById("sliderThumb");
        const sliderValue = document.getElementById("sliderValue");
        const clock = document.getElementById("clock");
        const startButton = document.getElementById("startButton");
        const stopButton = document.getElementById("stopButton");
        const fileNameInput = document.getElementById("fileNameInput");

        // Define step size
        const step = 0.5;

        // Initialize the displayed value and its color
        sliderValue.innerText = "0";
        updateColor(0);

        // Variables to track mouse interaction
        let isDragging = false;

        // Variables for recording data
        let isRecording = false;
        let csvData = ""; // Store CSV data

        // Add mouse event listeners to enable slider interaction
        sliderThumb.addEventListener("mousedown", () => {
            isDragging = true;
        });

        document.addEventListener("mousemove", (event) => {
            if (isDragging) {
                updateSlider(event);
            }
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
        });

        // Add touch event listeners for mobile devices
        sliderThumb.addEventListener("touchstart", () => {
            isDragging = true;
        });

        document.addEventListener("touchmove", (event) => {
            if (isDragging) {
                updateSlider(event.touches[0]);
            }
        });

        document.addEventListener("touchend", () => {
            isDragging = false;
        });

        // Function to update the slider's position and the displayed value
        function updateSlider(event) {
            const containerWidth = sliderContainer.clientWidth;
            const clickX = event.clientX - sliderContainer.getBoundingClientRect().left;
            const percent = Math.min(1, Math.max(0, clickX / containerWidth));
            let value = -3 + percent * 6; // Map to the range -3 to 3

            // Snap the value to the nearest step
            value = Math.round(value / step) * step;

            // Update the position of the slider thumb
            sliderThumb.style.left = `${((value + 3) / 6) * 100}%`;

            // Update the displayed value and its color
            sliderValue.innerText = value.toFixed(1);
            updateColor(value);
        }

        // Function to update the color based on the slider's position
        function updateColor(value) {
            // Map the value to a color gradient from blue (cold) to red (hot)
            const min = -3;
            const max = 3;
            const percent = (value - min) / (max - min);
            const red = Math.floor(255 * percent);
            const blue = Math.floor(255 * (1 - percent));
            const color = `rgb(${red}, 0, ${blue})`;

            // Apply the color to the value display
            sliderValue.style.backgroundColor = color;
            sliderValue.style.color = "white"; // Set text color to white for better visibility on colored background
        }

        // Function to update the clock display
        function updateClock() {
            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            clock.innerText = `${date} ${time}`;
        }

        // Update the clock every second (1000 milliseconds)
        setInterval(updateClock, 1000);

        // Function to start recording
        function startRecording() {
            isRecording = true;
            csvData = ""; // Clear existing data
            startButton.classList.add("start-button-recording"); // Change button color
        }

        // Function to stop recording
        function stopRecording() {
            isRecording = false;
            startButton.classList.remove("start-button-recording"); // Restore button color
            saveCSVData();
        }

        // Function to save the CSV data as a file
        function saveCSVData() {
            if (csvData) {
                const blob = new Blob([csvData], { type: 'text/csv' });
                const a = document.createElement('a');
                const fileName = fileNameInput.value || 'selected_values.csv'; // Use entered file name or default
                a.href = URL.createObjectURL(blob);
                a.download = fileName;
                a.style.display = 'none'; // Hide the link
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        // Button to start recording
        startButton.addEventListener("click", () => {
            if (!isRecording) {
                startRecording();
                setInterval(() => {
                    const selectedValue = parseFloat(sliderValue.innerText);
                    recordValue(selectedValue);
                }, 60000);
            }
        });

        // Button to stop recording
        stopButton.addEventListener("click", () => {
            if (isRecording) {
                stopRecording();
            }
        });

        // Function to record a value
        function recordValue(value) {
            if (isRecording) {
                const now = new Date();
                const formattedTime = now.toLocaleString(); // Format time as a human-readable string
                csvData += `${formattedTime},${value}\n`;
            }
        }
    </script>
</body>
</html>
